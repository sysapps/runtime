<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Runtime and Security Model for Web Applications
    </title>
    <script src="http://www.w3.org/Tools/respec/respec-w3c-common" class=
    "remove">
</script>
    <script class='remove'>
var respecConfig = {
        specStatus:           "ED",
        shortName:            "runtime",

        //publishDate:  "2012-12-12",
        previousPublishDate:  "2013-03-21",
        previousMaturity:     "FPWD",
        edDraftURI:           "http://runtime.sysapps.org",
        // lcEnd: "3000-01-01",
        // crEnd: "3000-01-01",

        editors: [
            {
              name: "Mounir Lamouri",
              company: "Mozilla",
              companyURL: "http://mozilla.org/"
            },
            {
              name: "金明 (Ming Jin)",
              company: "Samsung Electronics, Co., Ltd",
              companyURL: "http://www.samsung.com/sec"
            },
        ],

        inlineCSS:     true,
        noIDLIn:       true,
        noLegacyStyle: false,
        extraCSS:      ["../ReSpec.js/css/respec.css"],

        wg:           "System Applications Working Group",
        wgURI:        "http://www.w3.org/2012/sysapps/",
        wgPublicList: "public-sysapps",
        wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/58119/status"
      };
    </script>
    <style>
.todo { display: none; }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This document specifies two classes of Web application: <em>hosted Web
        applications</em> and <em>packaged applications</em>. These
        applications differ from traditional Web applications in their life
        cycle, security model, and access to APIs that are not normally
        available to Web applications. Conceptually, the application manifest
        indicates that an application can be "installed" on an end-user's
        device. What distinguishes a traditional Web application from a hosted
        web application is an application manifest: this is a JSON resource
        that contains application specific metadata (e.g., the name of the
        application), and optionally various security related permission
        requests to resources on the Web and/or services and capabilities on
        the device.
      </p>
      <figure>
        <a href="#apptypesdesc"><img src="images/apptypes.png" alt=""></a>
        <figcaption id="apptypesdesc">
          The figure shows the overlap between traditional web applications,
          hosted web applications, and packaged applications. Web applications
          make use of standard Web technologies but don't make use of an
          application manifest. On the other hand, hosted applications make use
          of an application manifest, while packaged applications have both an
          application manifest and are packaged using [[!ZIP]].
        </figcaption>
      </figure>
      <p>
        Installation of hosted or packaged applications onto a device can be
        initiated through either linking to an application manifest or through
        the use of the <code>ApplicationRegistry</code> API. This API gives a
        developer a degree of control over the installation process.
      </p>
      <p>
        This specification also specifies aspects related to the application's
        lifecycle that are outside the control of the developer. These events
        sometimes result in <em>system messages</em> being generated.
        Developers can register event listeners to listen for these special
        events during the life cycle of their application.
      </p>
    </section>
    <section id="conformance">
      <p>
        There is only one class of product that can claim conformance to this
        specification: a <dfn>user agent</dfn>.
      </p>
      <p>
        The IDL fragments in this specification must be interpreted as required
        for conforming IDL fragments, as described in the Web IDL
        specification. [[!WEBIDL]].
      </p>
    </section>
    <section>
      <h2>
        Terminology
      </h2>
      <p>
        The <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handlers">EventHandler</a></dfn>
        interface represents a callback used for event handlers as defined in
        [[!HTML5]].
      </p><!--
      <p>
        The concepts <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">
        queue a task</a></dfn> and
        <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
        fire a simple event</a></dfn> are defined in [[!HTML5]].
      </p>
      -->
      <p>
        The concept of <dfn><a href=
        'http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event'>fire
        a simple event</a></dfn> is defined in [[!HTML5]].
      </p>
      <p>
        The terms <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handlers">event
        handlers</a></dfn> and <dfn><a href=
        "http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The <dfn><a href=
        'http://dvcs.w3.org/hg/domcore/raw-file/tip/Overview.html/#interface-domerror'>
        DOMError</a></dfn> interface represents an error handling object as
        defined in [[!DOM4]].
      </p>
    </section>
    <section>
      <h2>
        Application Manifest and its members
      </h2>
      <p>
        An <dfn>application manifest</dfn> is a JSON document [[!RFC4627]] that
        describes various aspects of a <a>packaged application</a> or hosted
        web application. Some of these aspects are presentational, others
        aspects have security sensitive implications. An application manifest
        consists of a top-level object (the <dfn>manifest root</dfn>) and one
        or more members, some of which can themselves contain objects.
      </p>
      <p id="ecmascript-abstractop">
        Algorithms in this section use the conventions described in <a class=
        "external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-5.2">ECMA-262
        section 5.2</a>, such as the use of steps and substeps, and so on. The
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.2"><dfn>ToBoolean</dfn></a>,
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.3"><dfn>ToNumber</dfn></a>,
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.7"><dfn>ToUint16</dfn></a>,
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.5"><dfn>ToInt32</dfn></a>,
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.6"><dfn>ToUint32</dfn></a>,
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.8"><dfn>ToString</dfn></a>,
        and <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.9"><dfn>ToObject</dfn></a>
        abstract operations and the <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-8">Type(<var>x</var>)</a>
        notation referenced in this section are defined in [[!ECMA-262-51]]. In
        the algorithms, to <dfn>ignore</dfn> means that the user agent MUST act
        as if the author had not declared the particular member in the
        application manifest document.
      </p>
      <p>
        Certain error conditions can result in an <a>application manifest</a>
        being treated as an <a>invalid manifest</a>. An <dfn>invalid
        manifest</dfn> is an application manifest that is deemed to be
        non-conforming in such a way that it would not be possible for the user
        agent to continue processing (e.g., it can't be parsed by the JSON
        parser). In such a case, the user agent may report the error to the
        user in a user-agent-specific manner, may <a href=
        "http://www.whatwg.org/specs/web-apps/current-work/#navigate">navigate</a>
        to an error page to report the error, or may ignore the error and do
        nothing. In either case, when a step results in an <a>invalid
        manifest</a> the user agent MUST abort whatever steps caused the
        condition.
      </p>
      <p>
        The <dfn>steps for fetching an application manifest</dfn> are given by
        the following algorithm. This algorithm can be applied equally to
        manifests fetched from HTTP/S or those derived over the app URI scheme.
      </p>
      <ol class="algorithm">
        <li>Let <var>url</var> be a <a href=
        "http://www.whatwg.org/specs/web-apps/current-work/multipage/urls.html#url">
          URL</a> with character encoding [[!UTF-8]] that represents the
          <a>application manifest</a>.
        </li>
        <li>Let <var>origin</var> be ??.
        </li>
        <li>Resolve <var>url</var> relative to <var>origin</var>. If <a href=
        "http://www.whatwg.org/specs/web-apps/current-work/#resolve-a-url"
        title="resolve a url">resolving</a> the <a href=
        "http://www.whatwg.org/specs/web-apps/current-work/#url">URL</a> fails,
        then treat this as an <a>invalid manifest</a>.
        </li>
        <li>Let <var>response body</var> be the <a href=
        "http://xhr.spec.whatwg.org/#response-entity-body">response entity
        body</a> resulting from of asynchronously <a href=
        "http://www.whatwg.org/specs/web-apps/current-work/#fetch">fetching</a>
        <var>url</var>, with <var>origin</var> as the origin, and with the
        force same-origin flag set.
        </li>
        <li>Let <var>text</var> be the result of running <a href=
        "http://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on the
        byte stream <a href="http://xhr.spec.whatwg.org/#response-entity-body">
          </a><var>response body</var>.
        </li>
        <li>return <var>text</var>.
        </li>
      </ol>
      <p>
        The <dfn>steps for processing an application manifest</dfn> are given
        by the following algorithm.
      </p>
      <ol class="algorithm">
        <li>Let <var>text</var> be the text to be processed.
        </li>
        <li>Let <var>manifest</var> result of invoking the parse function of
        the JSON object defined in [[!ECMA-262-51]] with <var>text</var> as its
        only argument. If parsing throws an exception, then treat this
        application manifest as an <a>invalid manifest</a>.
        </li>
        <li>Let <var>default locale</var> be the result of running the <a>steps
        for processing the <code>default_locale</code> member</a>.
          <ol>
            <li>If <var>default locale</var> is not <var>undefined</var>:
              <ol>
                <li>from <var>default locale</var>.
                </li>
                <li>If there is no occurance of <var>default locale</var> in
                the application locales list, then insert <var>default
                locale</var> immediately before the last item of the
                <var>application locale list</var>.
                  <p>
                    For example, given <var>default locale</var> "jp", and an
                    <var>application locale list</var> containing "en-US,*",
                    then the application locale list would become ["en-US",
                    "jp", "*"].
                  </p>
                </li>
              </ol>
            </li>
          </ol>
        </li>
        <li>Let <var>name</var> be the result of running the <a>steps for
        processing the <code>name</code> member</a>:
          <ol>
            <li>If <var>name</var> is an error, treat this as an <a>invalid
            manifest</a>.
            </li>
          </ol>
        </li>
        <li>Let <var>launch path</var> be the result of running the <a>steps
        for processing the <code>launch_path</code> member</a>:
          <ol>
            <li>If <var>launch path</var> resulted in an error, then treat this
            as an <a>invalid manifest</a>.
            </li>
          </ol>
        </li>
        <li>Let <var>description</var> be the result of running the <a>steps
        for processing the <code>description</code> member</a>.
        </li>
        <li>Let <var>fullscreen</var> be the result of running the <a>steps for
        processing the <code>fullscreen</code> member</a>.
        </li>
        <li>...
        </li>
        <li>Optionally, <a>ignore</a> all other members.
        </li>
      </ol>
      <section>
        <h3>
          Types and bindings
        </h3>
        <p>
          As the manifest format is a JSON document, this doucment relies on
          the types defined in [[!RFC4627]] specification: namely <dfn id=
          "json-object">object</dfn>, <dfn id="json-array">array</dfn>,
          <dfn id="json-number">number</dfn>, and <dfn id=
          "json-string">string</dfn>. Strict validation checking to types is
          not enforced by this specification. Instead, each member definition
          defines the steps to required to process a particular member.
          Processing relies on
        </p>
        <p>
          In additon, for the purpose of validity checking, this specification
          defines the following types:
        </p>
        <dl>
          <dt>
            <dfn>relative URL</dfn>
          </dt>
          <dd>
            The concept of a relative URL is defined in the [[!URL]]
            specification.
          </dd>
          <dt>
            <dfn>absolute URL</dfn>
          </dt>
          <dd>
            The concept of an absolute URL is defined in the [[!URL]]
            specification.
          </dd>
        </dl>
      </section>
      <section class="informative">
        <h3>
          Example manifest
        </h3>
        <p>
          <em>This section is non-normative.</em>
        </p>
        <p>
          The following shows a typical <a>application manifest</a>. Only the
          name and the description members are required.
        </p>
        <pre class="example highlight">
{
  "name": "The Example App",
  "description": "Exciting Open Web development action!",
  "launch_path": "/",
  "version": "1.0",
  "icons": {
    "16": "/img/icon_16.png",
    "48": "/img/icon_48.png",
    "128": "/img/icon_128.png"
  },
  "developer": {
    "name": "Foo Corp.",
    "url": "http://sysapps.org/example"
  },
  "appcache_path": "/cache.manifest",
  "locales": {
    "es": {
      "description": "¡Acción abierta emocionante del desarrollo del Web!",
      "developer": {
        "url": "https://sysapps.org/example/es-ES"
      }
    }
  },
  "default_locale": "en",
  "screen_size": {
    "min_width": "600",
    "min_height": "300"
  },
  "required_features": ["touch", "geolocation", "webgl"],
  "permissions": {
    "contacts": {
      "description": "Required for auto-completion in the share screen",
      "access": "read"
    }
  },
  "fullscreen": "true",
  "relNotes": {
    "1.0": "Bugs fixed. New exciting effects. Ready for an official release!",
    "0.5": "First alpha version with still some bugs but already fun!"
  },
  <!-- See https://github.com/sysapps/runtime/pull/11 
  
  "data": {
     myCustomAppData: ["x", "y", {"z": "foo"}]
  }
  -->
}
</pre>
      </section>
      <section>
        <h3>
          Internationalization and localization
        </h3>
        <p>
          The <dfn>user agent's locales</dfn> is an ordered list of <a title=
          "language tag">language tags</a> that are used to represent the
          end-user's language(s) and localization preference for experiencing
          content; these are essentially equivalent to the language tags sent
          by the user agent through the <code>Accept-Language</code> [[HTTP11]]
          header, but without the quality values.
        </p>
        <p>
          The case sensitivity and case mapping for language tags is the same
          as that defined in section 6.1 of the ECMAScript Internationalization
          API Specification [[!ECMAS-402]]
        </p>
        <p>
          As there are numerous ways a user agent can derive the end-user's
          preferred languages and regional settings (e.g., the end user might
          have set them in the user agent's preferences), the means by which
          those values are derived are left up to the implementation. The first
          item of the <a>user agent's locales</a> represents the user's most
          preferred language range (i.e., the language/region combination the
          user agent assumes the end-user most prefers), followed by the next
          most preferred language range, and so forth.
        </p>
        <p>
          A <dfn>language tag</dfn> is a string that matches the production of
          a <code>Language-Tag</code> defined in the [[!BCP47]] specifications
          (see the <a href=
          "http://www.iana.org/assignments/language-subtag-registry">IANA
          Language Subtag Registry</a> for an authoritative list of possible
          values, see also the <a href=
          "http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements">
          Maintenance Agency for ISO 3166 country codes</a>). That is, a
          language range is composed of one or more <dfn>subtags</dfn> that are
          delimited by a U+002D HYPHEN-MINUS ("-"). For example, the
          '<code>en-AU</code>' language range represents English as spoken in
          Australia, and '<code>fr-CA</code>' represents French as spoken in
          Canada. Language tags that meet the validity criteria of [[!RFC5646]]
          section 2.2.9 that can be verified without reference to the IANA
          Language Subtag Registry are considered structurally valid.
        </p>
        <p>
          The <dfn>CanonicalizeLocaleList</dfn>, <dfn>BestAvailableLocale</dfn>
          <dfn>LookupMatcher,</dfn> <dfn>BestFitMatcher</dfn>,
          <dfn>ResolveLocale</dfn>, <dfn>LookupSupportedLocales</dfn>
          <dfn>BestFitSupportedLocales</dfn> <dfn>SupportedLocales</dfn>.
        </p>
      </section>
      <section>
        <h3>
          Localizable members
        </h3>
        <p>
          A <dfn>localizable member</dfn> is member of the <a>application
          manifest</a> that can appear in the <var>locales</var> member.
        </p>
        <p>
          The <dfn>steps for retrieving a localizable member from the
          manifest</dfn> are given by the following algorithm. The algorithm
          prioritizes returning the localized version of a member over one
          where the locale is unknown. The algorithm returns either a value
          from the namifest or <code>undefined</code>.
        </p>
        <ol class="algorithm">
          <li>Let <var>manifest</var> be the JSON-parsed object representation
          of the <a>application manifest</a>.
          </li>
          <li>Let <var>default app locale</var> be the string that represents
          the default locale for the application manifest.
          </li>
          <li>Let <var>indentifier</var> be a string that is the name of the
          member being sought.
          </li>
          <li>Let <var>locales list</var> be a copy of the <a>user agent's
          locales</a>.
          </li>
          <li>If <var>default app locale</var> is not <code>undefined</code>,
          append <var>default app locale</var> to <var>locales list</var>.
          </li>
          <li>If the <var>manifest</var> has a property whose name is
          <code>"locales</code>", then for each <var>range</var> in the
          <var>locales list</var> in order:
            <ol>
              <li>If the "<code>locales</code>" property has a property whose
              identifier matches <var>range</var>, then:
                <ol>
                  <li>if return the value of the matching property and
                  terminate this algorithm.
                  </li>
                </ol>
              </li>
              <li>Otherwise, if the "<code>locales</code>" property has a
              property whose identifier matches the <var>default app
              locale</var>, then return the value of the matching property and
              terminate this algorithm.
              </li>
            </ol>
          </li>
          <li>If the <a>manifest root</a> has its own property named
          <var>prop</var>, return the value of the property.
          </li>
          <li>Return <code>undefined</code>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">name</code> member
        </h3>
        <p>
          The <dfn id="propdef-name"><code>name</code></dfn> <a>localizable
          member</a> is a string that represents the name of the hosted web
          application or packaged application, that is used, for example, in an
          application menu or in other contexts.
        </p>
        <p class="note">
          Note: The <code>name</code> member needs to be present in the
          application manifest for the user agent to treat an application
          manifest as valid.
        </p>
        <p>
          The <dfn>steps for processing the name member</dfn> is given by the
          following algorithm. The algorithm takes an application manifest as
          an argument and returns either an error or a string:
        </p>
        <ol class="algorithm">
          <li>Let <var>key</var> be the string "<code>name</code>".
          </li>
          <li>Let <var>present</var> be the result of calling
          [[[HasOwnProperty]]] internal method of <var>manifest</var> with
          argument <var>key</var>.
          </li>
          <li>If <var>present</var> is <code>false</code>, return an error and
          terminate this algorithm.
          </li>
          <li>Otherwise, let <var>value</var> be the result of running the <a>
            steps for retrieving a localizable member from the manifest</a>,
            with <var>key</var> as the member being sought.
          </li>
          <li>Let <var>result</var> be the result of calling
          <a>ToString</a>(<var>value</var>).
          </li>
          <li>Return the <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">description</code> member
        </h3>
        <p>
          The <dfn id="propdef-description"><code>description</code></dfn>
          <a>localizable member</a> is a string that describes to the end-user
          the author's intended purpose for the application (i.e., what app
          does, what the app is for, etc.).
        </p>
        <p>
          The <dfn>steps for processing the description member</dfn> are given
          by the following algorithm. The algorithm takes an application
          manifest as an argument and returns a string or
          <code>undefined</code>:
        </p>
        <ol class="algorithm">
          <li>Let <var>key</var> be the string "description".
          </li>
          <li>Let result be <code>undefined</code>.
          </li>
          <li>Let <var>value</var> be the result of running the <a>steps for
          retrieving a localizable member from the manifest</a>, with
          <var>key</var> as the member being sought.
          </li>
          <li>If <var>value</var> is not <code>undefined</code>, let
          <var>result</var> be <a>ToString</a>(<var>value</var>).
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">default_locale</code> member
        </h3>
        <p>
          The <dfn id="propdef-default_locale">default_locale</dfn> member is a
          <a>language tag</a> that represents:
        </p>
        <ul>
          <li>The locale of the content of members at the root of the manifest.
          </li>
          <li>The default locale that the user agent will use in case the
          <a>user agent's locales</a> do not match any localized members.
          </li>
        </ul>
        <p>
          When the <code>default_locale</code> member is missing or in error,
          the content at the root of the manifest is said to have an
          <dfn>unknown locale</dfn>.
        </p>
        <p>
          The <dfn>steps for processing the <code>default_locale</code>
          member</dfn> are given by the following algorithm. The algorithm
          takes the JSON-parsed application <var>manifest</var> as an argument.
          The algorithm returns a string, which is either a <a>language tag</a>
          or the string "*" (which is used to represent an <a>unknown
          locale</a>).
        </p>
        <ol class="algorithm">
          <li>Let <var>result</var> be "*".
          </li>
          <li>Let <var>key</var> be "<code>default_locale</code>".
          </li>
          <li>Let <var>present</var> be the result of calling
          [[[HasOwnProperty]]] internal method of <var>manifest</var> with
          argument <var>key</var>.
          </li>
          <li>If <var>present</var> is <var>true</var>:
            <ol>
              <li>Let <var>value</var> be the result of calling the
              [[GetOwnProperty]] internal method of <var>manifest</var> passing
              <var>key</var> as the argument.
              </li>
              <li>Let <var>tag</var> be <a>ToString</a>(<var>value</var>).
              </li>
              <li>Let <var>valid tag</var> the result of calling the abstract
              operation IsStructurallyValidLanguageTag with <var>tag</var> as
              the argument.
              </li>
              <li>If <var>valid tag</var> is <code>true</code>, then:
                <ol>
                  <li>Let <var>result</var> be the result of calling the
                  abstract operation <a href=
                  "http://www.ecma-international.org/ecma-402/1.0/#sec-6.2.3">
                    CanonicalizeLanguageTag</a>, passing <em>tag</em> as the
                    argument.
                  </li>
                </ol>
              </li>
            </ol>
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>launch_path</code> member
        </h3>
        <p>
          The <dfn id="propdef-launch_path">launch_path</dfn> localizable
          member is a <a>relative URL</a> that represents a resource within the
          <a>origin of the application</a> that is <a href=
          "http://www.w3.org/html/wg/drafts/html/master/single-page.html#browsers">
          loaded</a> when the application is <a>launched</a>.
        </p>
        <p>
          The <dfn>steps for processing the <code>launch_path</code>
          member</dfn> are given by the following algorithm. The algorithm
          returns either a string, and error, or <code>undefined</code>.
        </p>
        <ol class="algorithm">
          <li>Let <var>result</var> be <code>undefined.</code>
          </li>
          <li>Let <var>key</var> be the string "<code>launch_path</code>".
          </li>
          <li>Let <var>present</var> be the result of calling
          [[[HasOwnProperty]]] internal method of <var>manifest</var> with
          argument <var>key</var>.
          </li>
          <li>If present is <code>true</code>:
            <ol>
              <li>Let <var>path</var> be <a>ToString</a>(<var>value</var>).
              </li>
              <li>Let <var>url</var> be the result of <a href=
              "http://url.spec.whatwg.org/#parsing">parsing</a>
              <var>path</var>.
              </li>
              <li>iI <var>url</var> is not a <a href=
              "http://url.spec.whatwg.org/#concept-absolute-url">relative
              URL</a>, then return an error and terminate this algorithm.
              </li>
              <li>Set <var>result</var> to be the value of <var>url</var>.
              </li>
            </ol>
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">icons</code> member
        </h3>
        <p>
          The <dfn id="propdef-icons">icons</dfn> <a>localizable member</a> is
          a <a>icons object</a> that represents a set of icons that the
          application can make use.
        </p>
      </section>
      <section>
        <h3>
          <code>developer</code> member
        </h3>
        <p>
          The <dfn id="propdef-developer">developer</dfn> <a>localizable
          member</a> is a <a>developer object</a> that represents the person,
          persons, or entity that created the application.
        </p>
      </section>
      <section>
        <h3>
          <code title="">locales</code> member
        </h3>
        <p>
          The <dfn id="propdef-locales">locales</dfn> member is a
          <a>localized-content object</a> represents the localized data of the
          manifest.
        </p>
      </section><!-- Commented because it is a controversial feature.
          <li><dfn id=
          "propdef-installs_allowed_from">installs_allowed_from</dfn>: An array
          of origins that are allowed to trigger installation of this
          application. This field allows the developer to restrict installation
          of their application to specific sites. If the value is omitted,
          installs are allowed from any site.</li>
-->
      <section>
        <h3>
          <code>appcache_path</code> member
        </h3>
        <p>
          The <dfn id="propdef-appcache_path">appcache_path</dfn>
          <a>localizable member</a> is an <a>absolute URL</a> that represents a
          resource to be used as the application's cache manifest
          [[!OFFLINE-WEBAPPS]].
        </p>
        <p>
          The <dfn>steps for processing the <code>appcache_path</code>
          member</dfn> are given by the following algorithm. The algorithm
          returns either a string, and error, or <code>undefined</code>.
        </p>
        <ol class="algorithm">
          <li>Let <var>result</var> be <code>undefined.</code>
          </li>
          <li>Let <var>key</var> be the string "<code>appcache_path</code>".
          </li>
          <li>Let <var>present</var> be the result of calling
          [[[HasOwnProperty]]] internal method of <var>manifest</var> with
          argument <var>key</var>.
          </li>
          <li>if <var>present</var> is <code>true</code>:
            <ol>
              <li>Let <var>path</var> be <a>ToString</a>(<var>value</var>).
              </li>
              <li>Let <var>url</var> be the result of <a href=
              "http://url.spec.whatwg.org/#parsing">parsing</a>
              <var>path</var>.
              </li>
              <li>iI <var>url</var> is not a <a href=
              "http://url.spec.whatwg.org/#concept-absolute-url">absolute
              URL</a>, then return an error and terminate this algorithm.
              </li>
              <li>Set <var>result</var> to be the value of <var>url</var>.
              </li>
            </ol>
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>version</code> member
        </h3>
        <p>
          The <dfn id="propdef-version">version</dfn> <a>localizable member</a>
          is a string represents the version of the application as designated
          by the author. The version has no specific meaning in the context of
          this specification; it's utility is solely for informative purposes.
        </p>
        <p>
          The <dfn>steps for processing the <code>version</code> member</dfn>
          is given by the following algorithm. The algorithm returns either
          undefined or a string:
        </p>
        <ol class="algorithm">
          <li>Let <var>result</var> be <code>undefined</code>.
          </li>
          <li>Let <var>key</var> be the string "version".
          </li>
          <li>Let <var>present</var> be the result of calling
          [[[HasOwnProperty]]] internal method of <var>manifest</var> with
          argument <var>key</var>.
          </li>
          <li>If <var>present</var> is <code>true</code>:
            <ol>
              <li>Let <var>value</var> be the result of running the <a>steps
              for retrieving a localizable member from the manifest</a>, with
              <var>key</var> as the member being sought.
              </li>
              <li>Let <var>result</var> be the result of calling
              <a>ToString</a>(<var>value</var>).
              </li>
            </ol>
          </li>
          <li>Return the <var>result</var>.
          </li>
        </ol>
      </section>
      <!-- Attempt to address "The spec should discourage people from extending the manifest format." 
         https://github.com/sysapps/runtime/pull/11
    
    <section>
      <h3>
        <code>data</code> member
      </h3>
      <p>
        The <dfn><code>data</code></dfn> member represents any additional data
        that the developer might want to provide for their application. The
        value is any valid JSON data structure or type. This member is not used
        in configuring the application, hence no processing rules are defined.
      </p>
      <p>
        Developers can access the value of this member through the Application
        interface.
      </p>
    </section>
    -->
      <section>
        <h3>
          <code title="">screen_size</code> member
        </h3>
        <p>
          The <dfn id="propdef-screen_size">screen_size</dfn> member is a
          <a>screen sizes object</a> that represents the minimum visual
          dimensions (in <a href=
          "http://www.w3.org/TR/2008/REC-CSS2-20080411/syndata.html#length-units">
          CSS pixels</a> [[!CSS21]]) the application needs to render correctly.
        </p>
        <p class="issue">
          ISSUE: This should probably be dropped. If a user zooms in, or even
          if the screen is too small, then this won't really help. This is also
          meaningless when the application is full screen. Also, this needs to
          play with @viewport and meta viewport.
        </p>
      </section>
      <section>
        <h3>
          <code title="">required_features</code> member
        </h3>
        <p>
          The <dfn id="propdef-required_features">required_features</dfn>
          member is an array that represents the feature set the application
          needs in order to run correctly.
        </p>
        <p>
          ISSUE: Standard features of the Web platform should not be on this
          list (e.g., geolocation, webgl, etc.).
        </p>
      </section>
      <section>
        <h3>
          <code title="">fullscreen</code> member
        </h3>
        <p>
          The <dfn id="propdef-fullscreen">fullscreen</dfn> member is a boolean
          that represents a hint to the user agent that indicates that the
          application provides the best user experience when shown in
          fullscreen (i.e., the application is presented without any use
          interface components of the underlying system). When the value is
          missing, it defaults to <var>false</var>.
        </p>
        <p>
          The <dfn>steps for processing the <code>fullscreen</code>
          member</dfn> are given by the following algorithm:
        </p>
        <ol>
          <li>Let <var>value</var> be the value of the <var>fullscreen</var>
          member or f<var>alse</var> if the value is missing.
          </li>
          <li>Let <var>result</var> of calling <a>ToBoolean</a>(value).
          </li>
          <li>return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">relNotes</code> member
        </h3>
        <p>
          The <dfn id='propdef-relnotes'>relNotes</dfn> <a>localizable
          member</a> is a <a>release notes object</a> that represents a change
          history for the application from one version to another.
        </p>
      </section>
      <section>
        <h3>
          <code title="">permissions</code> member
        </h3>
        <p>
          The <dfn id="propdef-permisssions">permissions</dfn> <a>localizable
          member</a> is a <a>permissions object</a> that represents a list of
          permissions that the application requires to function.
        </p>
      </section>
      <!-- Commented because it should go to the Web Intents/Web Activities spec.
          <li><dfn id="propdef-activities">activities</dfn>: This value specifies
          a set of
          <a href="https://wiki.mozilla.org/WebAPI/WebActivities">WebActivities</a>
          that this app supports. Each property in this value is a discrete
          activity whose name matches the property name. Activity names are
          free-form text, and each activity is represented by an object. This
          object MUST contain the following property:

          <ul>
            <li><dfn id="propdef-activities-href">href</dfn>: When another app
            or web page initiates an activity that is supported by this app, if
            this app is chosen to perform the activity, this page will be opened
            in the manner specified by the <dfn>disposition</dfn> property. The
            manner in which a particular app is chosen to perform an activity is
            out of scope for this specification.</li>
          </ul>

          An activity object MAY also contain the following properties:

          <ul>
            <li><dfn id="propdef-activites-disposition">disposition</dfn>: This
            value specifies how the page specified in <dfn>href</dfn> is presented
            when an activity is invoked. The value, if specified, MUST be one of
            the following (if omitted, defaults to <dfn>window</dfn>):
              <ul>
                <li><dfn id="propdef-activities-disposition-window">window</dfn>:
                The page handling the activity is opened in a new "window" (on a
                mobile device, for example, this view will replace the original
                app that requested the activity). The page MUST call
                <code>navigator.setMessageHandler</code> for each activity it
                supports and subsequently execute the activity for which it
                receives a message. Further, if the activity requires a return
                value, the page MUST call <code>activity.postResult</code> or
                <code>activity.postError</code> (where <code>activity</code> is
                the first argument provided to the function specified by
                <code>setMessageHandler</code>) as appropriate. These functions
                are specified in greater details in the WebActivities
                document.</li>

                <li><dfn id="propdef-activities-disposition-inline">inline</dfn>:
                The page handling the activity will open in an overlay (on a
                mobile device, for example, this will be rendered in a popup over
                the original app that requested the activity). Subsequent behavior
                is exactly the same as if the disposition were
                <dfn>window</dfn>.</li>
              </ul>

            <li><dfn id="propdef-activities-filters">filters</dfn>:
            <i>OPTIONAL</i>. This value is a dictionary, each property of which
            specified a particular filter. These filters will be applied while
            determining apps suitable for handling a given activity. Filter names
            are free-form text, but their values MUST be either a string or an
            array of strings (the exact type depends on the filter).</li>
          </ul>
-->
      <section>
        <h2>
          Release notes object and its members
        </h2>
        <p>
          TBW
        </p>
      </section>
      <section>
        <h2>
          Permissions object and its members
        </h2>
        <p>
          The permissions object...An application SHOULD list every API that is
          considered to require user permission in this field. Usage of an API
          without a corresponding entry in the manifest SHOULD fail. The field
          is an object, with each property name specifying a single permission,
          and object containing the following fields:
        </p>
        <section>
          <h3>
            Description member
          </h3>
          <p>
            The <dfn id="propdef-permissions-desc">description</dfn> member
            represents a human readable string specifying the intent behind
            requesting use of this API.
          </p>
          <p>
            ISSUE: This seems unhelpful. The developer can just lie.
          </p>
        </section>
        <section>
          <h3>
            access member
          </h3>
          <p>
            The <dfn id="propdef-permissions-access">access</dfn> is a string
            describing the type of access required for this permission. This
            field can be mandatory for a certain subset of permissions. Its
            value is one of:
          </p>
          <dl>
            <dt>
              <dfn>read</dfn>:
            </dt>
            <dd>
              ...
            </dd>
            <dt>
              <dfn>readwrite</dfn>:
            </dt>
            <dd>
              ...
            </dd>
            <dt>
              <dfn>readcreate</dfn>:
            </dt>
            <dd>
              ...
            </dd>
            <dt>
              <dfn>createonly</dfn>:
            </dt>
            <dd>
              ...
            </dd>
          </dl>
        </section>
      </section>
      <section>
        <h2>
          icons object and its members
        </h2>
        <p>
          The <dfn>icons object</dfn> is an object that represents the icons
          suitable for various dimensions.
        </p>
        <p>
          Paths beginning with "<code>/</code>" are treated as relative to the
          origin of the app.
        </p>
      </section>
      <section>
        <h2>
          Screen size object and its members
        </h2>
        <p>
          The screen size object . The screen sizes object values are only hint
          for the user agent
        </p>
      </section>
      <section>
        <h2>
          Locale object and its members
        </h2>
        <p>
          The locale object is an object that contains specific overrides of
          strings contained in the <a>application manifest</a>.
        </p>
        <section>
          <h3>
            Members
          </h3>
          <p>
            Each locale key is a <a>langauge tag</a>, and contains a sparse
            representation of localized parts of the manifest. The data of the
            <a>locales</a> members override the corresponding member in a
            localized user interface.
          </p>
          <p>
            The user agent MAY ignore some values if localizing the property
            doesn't appear to be legit.
          </p>
          <p>
            Note: if the <a>locales</a> property is set, the
            <a>default_locale</a> needs to also be set.
          </p>
        </section>
      </section>
      <section>
        <h2>
          Developer object and its members
        </h2>
        <section>
          <h3>
            <code title="">name</code> member
          </h3>
          <p>
            The <dfn id="propdef-developer-name">name</dfn> member of the
            <a>developer object</a> represents the name of the developer.
          </p>
          <p>
            The <dfn>steps for processing the name member of the developer
            object</dfn> is given by the following algorithm. The algorithm
            returns <code>undefined</code> or a string:
          </p>
          <ol class="algorithm">
            <li>Let <var>O</var> be the result of running the <a>steps for
            retrieving a localizable member from the manifest</a>, with
            "<var>developer"</var> as the member being sought.
            </li>
            <li>Let result be <code>undefined</code>.
            </li>
            <li>If Type(O) is "Object"
            </li>
            <li>Let <var>result</var> be the result of calling
            <a>ToString</a>(<var>value</var>).
            </li>
            <li>Return the <var>result</var>.
            </li>
          </ol>
        </section>
        <section>
          <h3>
            url member
          </h3>
          <p>
            The <dfn id="propdef-url">url</dfn> an URL pointing to the
            developer's website.
          </p>
        </section>
      </section>
    </section>
    <section>
      <h2>
        Application Management
      </h2>
      <section>
        <h2>
          <a>Application</a> interface
        </h2>
        <section>
          <p>
            Web Applications are represented by the <a>Application</a>
            interface.
          </p>
          <dl title='interface Application' class='idl'>
            <dt>
              readonly attribute DOMString origin
            </dt>
            <dd>
              The attribute MUST return the <a>application's origin</a>.
            </dd>
            <dt>
              readonly attribute Object manifest
            </dt>
            <dd>
              The attribute MUST return an object representing the parsed
              <a>application manifest</a>.
            </dd>
            <dt>
              readonly attribute DOMString installOrigin
            </dt>
            <dd>
              The attribute MUST return the origin of the page from which the
              application was installed. [[!ORIGIN]]
            </dd>
            <dt>
              readonly attribute unsigned long installTime
            </dt>
            <dd>
              The attribute MUST return the time in milliseconds since epoch at
              which the application was installed.
            </dd>
            <dt>
              readonly attribute Object parameters
            </dt>
            <dd>
              The attribute MUST return the parameters that were provided at
              install time. See <code>install()</code> in
              <a>ApplicationRegistry</a>.
            </dd>
            <dt>
              <a>DOMRequest</a> launch()
            </dt>
            <dd>
              This method MUST return a <a>DOMRequest</a> instance and then run
              the following steps asynchronously:
              <ol>
                <li>If the caller is not allowed by the UA to launch the
                application, the UA MUST fire an <code>error</code> event to
                the <a>DOMRequest</a> object with the
                <code>"NotAllowedError"</code> error code and exit those steps.
                </li>
                <li>If the caller is allowed to launch the application, the UA
                SHOULD launch the application.
                </li>
                <li>If the application has been successfully launched, the UA
                MUST fire a <code>success</code> event to the <a>DOMRequest</a>
                object and set <code>result</code> to null.<br>
                  Otherwise, the UA MUST fire an <code>error</code> event to
                  the <a>DOMRequest</a> object with an error code that
                  describes the error.
                </li>
              </ol>
            </dd>
            <dt>
              <a>DOMRequest</a> uninstall()
            </dt>
            <dd>
              This method MUST return a <a>DOMRequest</a> instance and then run
              the following steps asynchronously:
              <ol>
                <li>If the application is not currently installed, the UA MUST
                fire an <code>error</code> event to the <a>DOMRequest</a>
                object with the <code>"NotInstalledError"</code> error code and
                exit those steps.
                </li>
                <li>If the caller is not allowed by the UA to uninstall the
                application, the UA MUST fire an <code>error</code> event to
                the <a>DOMRequest</a> object with the
                <code>"NotAllowedError"</code> error code and exit those steps.
                </li>
                <li>If the caller is allowed to uninstall the application, the
                UA SHOULD uninstall the application.
                </li>
                <li>If the application has been successfully uninstalled, the
                UA MUST fire a <code>success</code> event to the
                <a>DOMRequest</a> object and set <code>result</code> to
                null.<br>
                  Otherwise, the UA MUST fire an <code>error</code> event to
                  the <a>DOMRequest</a> object with an error code that
                  describes the error.
                </li>
              </ol>
            </dd><!-- Update-related API -->
            <dt>
              readonly attribute DOMString updateState
            </dt>
            <dd>
              The attribute MUST return the empty string,
              <code>available</code>, <code>downloading</code>,
              <code>downloaded</code> or <code>installing</code>, depending on
              the state of the application.<br>
              If the application is being updated, the attribute MUST return
              <code>installing</code>.<br>
              If the application is ready to be updated, with the update fully
              downloaded or if there is no download to proceed to the update,
              the attribute MUST return <code>downloaded</code>.<br>
              If the application's update is being downloaded, the attribute
              MUST return <code>downloading</code>.<br>
              If there is an application update available, it is not being
              installed, nor downloaded, nor downloading, the attribute MUST
              return <code>available</code>. Otherwise, the attribute MUST
              return the empty string.
            </dd>
            <dt>
              readonly attribute unsigned long downloadSize
            </dt>
            <dd>
              The attribute SHOULD return the size of the download that would
              be required to update the application in kilobytes, if any. If
              the application does not have have an available update, if the
              download has already been done or if the UA can't find out the
              size of the download required for the update, the attribute MUST
              return 0.<br>
              If the download is happening, the attribute MUST return 0.<br>
              If the download has been made but interrupted and the UA is able
              to continue it, the attribute SHOULD return the remaining size to
              download.
            </dd>
            <dt>
              DownloadRequest downloadUpdate()
            </dt>
            <dd>
              The method MUST return a <a>DownloadRequest</a> object and
              asynchronously run the following steps:
              <ol>
                <li>If the application does not have an available update, the
                UA MUST send an <a>error message</a> to the request object with
                the value <code>InvalidState</code> and abort these steps.
                </li>
                <li>If the application does not require a download to process
                the update, the UA MUST send a <a>success message</a> to the
                request object with no value and abort these steps.
                </li>
                <li>If the application's update is currently being downloaded,
                the request MUST reflect the current state of the download.
                Otherwise, the request must <a>start the download</a>.
                </li>
              </ol>
            </dd><!-- Execution states related API -->
            <dt>
              readonly attribute DOMString state;
            </dt>
            <dd>
              The attribute MUST return <code>running</code> if the current
              application state is <a>running</a>. Otherwise, if the current
              application state is <a>paused</a>, it MUST return
              <code>paused</code>. Otherwise, it MUST return
              <code>terminated</code>.
            </dd>
            <dt>
              void hide()
            </dt>
            <dd>
              When this method is called, the UA SHOULD hide the application
              from the user. Hiding the application SHOULD fire visibility
              events as described in [[!PAGE-VISIBILITY]].<br>
              If the application was already not visible, this method MUST be a
              no-op.
            </dd>
            <dt>
              void exit()
            </dt>
            <dd>
              When this method is called, the UA MUST put the application state
              to <a>terminated</a> and fire the appropriate events.<br>
              If the application was already in the <a>terminated</a> state,
              this method MUST be a no-op.
            </dd>
            <dt>
              attribute EventHandler onlaunch
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt>
              attribute EventHandler onpause
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt>
              attribute EventHandler onresume
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt>
              attribute EventHandler onterminate
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
          </dl>
        </section>
        <p>
          The following are the <a>event handlers</a> (and their corresponding
          <a>event handler event types</a>) that MUST be supported as
          attributes by the <code>Application</code> objects:
        </p>
        <table class="simple">
          <thead>
            <tr>
              <th>
                event handler
              </th>
              <th>
                event handler event type
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <strong><code>onlaunch</code></strong>
              </td>
              <td>
                <code>launch</code>
              </td>
            </tr>
            <tr>
              <td>
                <strong><code>onpause</code></strong>
              </td>
              <td>
                <code>pause</code>
              </td>
            </tr>
            <tr>
              <td>
                <strong><code>onresume</code></strong>
              </td>
              <td>
                <code>resume</code>
              </td>
            </tr>
            <tr>
              <td>
                <strong><code>onterminate</code></strong>
              </td>
              <td>
                <code>terminate</code>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
      <section>
        <h2>
          <a>DownloadRequest</a> interface
        </h2>
        <section>
          <dl title='interface DownloadRequest : DOMRequest' class='idl'>
            <dt>
              void cancel()
            </dt>
            <dd>
              This method MUST stops the download and asynchronously send an
              <a>error message</a> to itself with the value
              <code>UserCancel</code>.
            </dd>
            <dt>
              attribute double progress
            </dt>
            <dd>
              If the current state is <code>error</code> the attribute MUST
              return 0.0. Otherwise, if the current state is
              <code>success</code>, the attribute MUST return 1.0. Otherwise,
              the attribute SHOULD return the current progress of the download
              expressed between 0.0 and 1.0.
            </dd>
            <dt>
              attribute EventHandler onprogress
            </dt>
            <dd class="todo">
              TBD
            </dd>
          </dl>
          <p>
            When the caller <dfn>start the download</dfn>, the
            <a>DownloadRequest</a> SHOULD start downloading the resource.
          </p>
          <p>
            If the resource fails to download, the UA MUST send an <a>error
            message</a> to the request.<br>
          </p>
          <p>
            If the resource succeed to download, the UA MUST send a <a>success
            message</a> to the request.
          </p>
          <p>
            While the resource is downloading, which means as long as
            <code>readyState</code> is <code>pending</code>, the UA SHOULD
            regularly <a>fire a simple event</a> named <a>progress</a> on the
            object. The UA should note that sending too much events might have
            an impact on performance but sending too few of them might impact
            the user experience.
          </p>
          <p>
            The following are the <a>event handlers</a> (and their
            corresponding <a>event handler event types</a>) that MUST be
            supported as attributes by the <code>DOMRequest</code> objects:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>
                  event handler
                </th>
                <th>
                  event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong><code>onprogress</code></strong>
                </td>
                <td>
                  <code>progress</code>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
      <section>
        <h2>
          Extension to the <a>Navigator</a> interface
        </h2>
        <section>
          <p>
            An <a>ApplicationRegistry</a> instance is exposed on the
            <code>Navigator</code> object trough the an <code>app</code>
            attribute.
          </p>
          <dl title='partial interface Navigator' class='idl'>
            <dt>
              readonly attribute ApplicationRegistry app
            </dt>
            <dd>
              The attribute MUST return an <a>ApplicationRegistry</a> instance.
            </dd>
          </dl>
        </section>
      </section>
      <section>
        <h2>
          <a>ApplicationRegistry</a> interface
        </h2>
        <section>
          <p>
            The <a>ApplicationRegistry</a> interface allows handling
            applications and query there status.
          </p>
          <dl title='interface ApplicationRegistry' class='idl'>
            <dt>
              DOMRequest install(in DOMString manifestUrl, [Optional] in Object
              parameters)
            </dt>
            <dd>
              This method MUST return a <a>DOMRequest</a> instance and then run
              the following steps asynchronously:
              <ol>
                <li>If the caller is not allowed by the UA to install the
                application, the UA MUST fire an <code>error</code> event to
                the <a>DOMRequest</a> object with the
                <code>"NotAllowedError"</code> error code and exit those steps.
                </li>
                <li>If the caller is allowed to install the application, the UA
                SHOULD install the application as described in the manifest at
                <code>manifestUrl</code>.
                </li>
                <li>If the application has been successfully installed, the UA
                MUST fire a <code>success</code> event to the <a>DOMRequest</a>
                object and set <code>result</code> to null.<br>
                  Otherwise, the UA MUST fire an <code>error</code> event to
                  the <a>DOMRequest</a> object with an error code that
                  describes the error.
                </li>
              </ol>
              <p>
                The UA SHOULD verify at any moment before installing that
                <code>manifestUrl</code> points to a valid manifest. If this is
                not the case, the UA MUST fire an <code>error</code> event to
                the <a>DOMRequest</a> object with the
                <code>"InvalidArgumentError"</code> and exit the steps.
              </p>
              <p>
                The UA SHOULD save the <code>parameters</code> if some are
                passed so they can later be retrieved by the
                <code>parameters</code> attribute on the <a>Application</a>
                interface.
              </p>
            </dd>
            <dt>
              DOMRequest getSelf()
            </dt>
            <dd>
              The UA SHOULD return a <a>DOMRequest</a> object and
              asynchronously check if the current context is an application
              context.<br>
              When the check is done, the UA SHOULD send a <code>success</code>
              event to the <a>DOMRequest</a> object and sets its
              <code>result</code> attribute to the <a>Application</a> object
              representing the current context or <code>null</code> if the
              current context is not an application context.
            </dd>
            <dt>
              DOMRequest getInstalled()
            </dt>
            <dd>
              The UA SHOULD return a <a>DOMRequest</a> object and
              asynchronously get all applications that have been installed by
              the caller's origin. [[!ORIGIN]]<br>
              When those applications are collected, the UA SHOULD send a
              <code>success</code> event to the <a>DOMRequest</a> object and
              populate its <code>result</code> attribute with an array of
              <a>Application</a> objects representing the applications.
            </dd>
            <dt>
              DOMRequest checkInstalled(DOMString manifestURL)
            </dt>
            <dd>
              The UA SHOULD return a <a>DOMRequest</a> object and
              asynchronously check if there is an installed application in the
              system with a manifest URL matching <i>manifestURL</i>.<br>
              After the asynchronous operation is done, the IA SHOULD send a
              <code>success</code> event to the <a>DOMRequest</a> object and
              populate its <code>result</code> attribute with the boolean value
              true if there is an installed application fulfilling the
              condition, otherwise <code>result</code> should be set to false.
            </dd>
            <dt>
              attribute ApplicationManagement management
            </dt>
            <dd>
              If the caller is not allowed to manage applications, the UA MUST
              return null. Otherwise, it MUST return an
              <a>ApplicationManagement</a> object.
              <ul class="todo">
                <li>Permission check is not clearly defined here. Should it be
                better?
                </li>
              </ul>
            </dd>
          </dl>
          <div class='todo'>
            <ul>
              <li>checkInstalled() could be synchronous. Seems way more
              convenient.
              </li>
            </ul>
          </div>
        </section>
      </section>
      <section>
        <h2>
          <a>ApplicationManagement</a> interface
        </h2>
        <section>
          <p>
            The <a>ApplicationManagement</a> interface allows access to all
            applications and is being informed any time an application is being
            installed or uninstalled. The intent of this interface is to be
            restricted to privileged callers.
          </p>
          <dl title='interface ApplicationManagement' class='idl'>
            <dt class='no-docs'>
              DOMRequest getAll()
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt class='no-docs'>
              DOMRequest applyUpdate(Application application)
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt class='no-docs'>
              attribute EventHandler oninstall
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt class='no-docs'>
              attribute EventHandler onuninstall
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
          </dl>
          <p>
            The <code>getAll</code> method SHOULD return a <a>DOMRequest</a>
            object and asynchronously get all installed applications.<br>
            When those applications are collected, the UA SHOULD send a
            <code>success</code> event to the <a>DOMRequest</a> object and
            populate its <code>request</code> attribute with an array of
            <a>Application</a> objects representing the applications.
          </p>
          <p>
            The <code>applyUpdate</code> method MUST return a <a>DOMRequest</a>
            object and perform the following steps asynchronously:
          </p>
          <ol>
            <li>If the application does not have an update or the update is not
            fully downloaded, the UA MUST send an <a>error message</a> to the
            request with the value <code>InvalidState</code> and abort these
            steps.
            </li>
            <li>Stop <i>application</i> from running if it is currently
            running.
            </li>
            <li>Replace the previous version with the new version of the
            application.
            </li>
            <li>If an error has occurred during the previous steps, the UA MUST
            send an <a>error message</a> to the request with any appropriate
            value. Otherwise, the UA MUST send a <a>success message</a> to the
            request with an <a>Application</a> object representing the updated
            application as a value.
            </li>
          </ol>
        </section>
        <section>
          <h2>
            Events
          </h2>
          <p>
            An <a>install</a> event using the <a>ApplicationEvent</a> interface
            MUST be fired on all <a>ApplicationManagement</a> instances as soon
            as an application is installed with the <code>application</code>
            attribute set to the <a>Application</a> object representing the
            installed application.
          </p>
          <p>
            The <a>uninstall</a> event using the <a>ApplicationEvent</a>
            interface MUST be fired on all <a>ApplicationManagement</a>
            instances as soon as an application is uninstalled with the
            <code>application</code> attribute set to the <a>Application</a>
            object representing the uninstalled application.
          </p>
          <p>
            The following are the <a>event handlers</a> (and their
            corresponding <a>event handler event types</a>) that MUST be
            supported as attributes by the <code>ApplicationManagement</code>
            object:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>
                  event handler
                </th>
                <th>
                  event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong><code>oninstall</code></strong>
                </td>
                <td>
                  <code>install</code>
                </td>
              </tr>
              <tr>
                <td>
                  <strong><code>onuninstall</code></strong>
                </td>
                <td>
                  <code>uninstall</code>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
      <section>
        <h2>
          Application Event Types
        </h2>
        <p>
          Application Events are sent when an event happen on the application
          level like an application being installed or uninstalled.
        </p>
        <section>
          <dl title=
          '[Constructor(DOMString type, ApplicationEventInit eventInitDict)] interface ApplicationEvent : Event'
          class='idl'>
            <dt>
              readonly attribute Application application
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
          </dl>
          <dl title='dictionary ApplicationEventInit : EventInit' class='idl'>
            <dt>
              Application application
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
          </dl>
        </section>
        <p>
          <a>ApplicationEvent</a> objects MUST contain a non-null
          <code>application</code> attribute representing the application on
          each the action happened.<br>
          The application events are always sent asynchronously, do not bubble
          and are not cancelable.
        </p>
        <p>
          There are currently two types of Application Events:
        </p>
        <ul>
          <li>
            <dfn>install</dfn> is sent when an application is installed.
            <code>application</code> MUST represent the installed application.
          </li>
          <li>
            <dfn>uninstall</dfn> is sent when an application is uninstalled.
            <code>application</code> MUST represent the uninstalled
            application.
          </li>
        </ul>
      </section>
    </section>
    <section>
      <h2>
        Packaged applications
      </h2>
      <p>
        A <dfn>packaged application</dfn> is an application that is
        self-contained in a container. All resources that are commonly used by
        the application SHOULD be available in the container.
      </p>
      <p>
        A <dfn>hosted application</dfn> is an application that is not a
        <a>packaged application</a>.
      </p>
      <section class="informative">
        <h2>
          Use cases
        </h2>
        <p>
          A <a>packaged application</a> would be useful in a few situations,
          amongst them:
        </p>
        <ul>
          <li>If a marketplace wants to guarantee that an application is safe,
          it allows it to review the application codes and makes sure that all
          permissions granted can't be used outside of the reviewed code. In
          addition, it forces, by design, that any update will go trough the
          same review process.
          </li>
          <li>Some developers might want to develop for the Web Platform
          without investing in a server infrastructure. Any client-side only
          applications written on top of the Web Platform will be able to be
          very easily distributed that way.
          </li>
        </ul>
      </section>
      <section>
        <h2>
          Package format
        </h2>
        <p>
          An <a>application manifest</a> for the application MUST be present at
          the root of the container.
        </p>
        <p>
          The container of a <a>packaged application</a> MUST be a ZIP file.
        </p>
      </section>
      <section>
        <h2>
          URI of a packaged file
        </h2>
        <p>
          A file contained in a <a>packaged application</a> MUST have an URI
          with the following rules:
        </p>
        <ul>
          <li>The <code>scheme</code> of the URI MUST be <i>app</i>.
          </li>
          <li>The <code>authority</code> of the URI MUST be an identifier
          unique for each applications. That means, two files from different
          applications can't share the same <code>authority</code> but two
          files from the same application will.
          </li>
          <li>The <code>path</code> of the URI MUST be the file name.
          </li>
          <li>Any other parts of the URI MUST be empty.
          </li>
        </ul>
        <p>
          For more information about URI's, refer to [[!RFC3986]].
        </p>
        <p>
          For example, the URI of <i>index.html</i> from an application can be:
          <i>app://e35b8412-7451-46e7-ab29-0cee24fd486a/index.html</i>.
        </p>
        <p>
          The URI of a packaged file is defined such as two files from the same
          <a>packaged application</a> MUST share the same origin.<br>
          A file from a <a>packaged application</a> and any other resource
          outside of this application (an application or not, packaged or not)
          MUST not share the same origin. [[!ORIGIN]]
        </p>
      </section>
      <section>
        <h2>
          Manifest
        </h2>
        <p>
          Inside an application package, the <dfn>valid application manifest
          filename</dfn> is <code>manifest.webapp</code>.
        </p>
        <p>
          A <a>packaged application</a> MUST have a copy of its <a>application
          manifest</a> outside of the package so it can be used for
          installation and updates purposes. As a consequence, that copy of the
          <a>application manifest</a> can be reduced to only a few properties:
          <a>name</a>, <a>version</a> and <a>relNotes</a>. In addition, a new
          property can be used only in the content a packaged <a>application
          manifest</a>: <dfn id='prop-package'>package</dfn> that SHOULD
          contain an object with the following properties:
        </p>
        <ul>
          <li>
            <dfn id='prop-package-url'>url</dfn>: this property MUST contain
            the URL of the package related to that <a>application
            manifest</a>.<br>
            When installing or updating a <a>packaged application</a> from an
            <a>application manifest</a>, the UA MUST always use the manifest
            inside the package as soon as the package is found.
          </li>
          <li>
            <dfn id='prop-package-size'>size</dfn>: the property SHOULD contain
            the size of the package in kilobytes.
          </li>
          <li>
            <dfn id='prop-package-sha256'>sha256</dfn>: this property SHOULD
            contain the SHA256 checksum of the package and SHOULD be used by
            the UA to verify the integrity of the downloaded package.
          </li>
        </ul>
        <pre class='example highlight'>
        {
          "name": "My Packaged App",
          "description": "This is my first packaged app!",
          "launch_path": "/",
          "version": "1.0",
          "developer": {
            "name": "Mozilla",
            "url": "https://mozilla.org/en-US"
          },
          "package": {
            "url": "http://example.org/mypackagedapp.zip",
            "size": "1024",
            "sha256": "6df134b0cfd88d6d4f27a99e29b9923d50eb8b2c0d5289c60012de424c7a9d97"
          }
        }
        
</pre>
      </section>
      <div class="todo">
        * Add relNotes to the properties of the manifest, like: 'relNotes': {
        '1.0': "This is what has been done...", '0.1': "That was so long
        ago..." }
      </div>
    </section>
    <section>
      <h2>
        Updates
      </h2>
      <p>
        An application SHOULD advertise an update by updating its
        <a>application manifest</a>.
      </p>
      <p>
        The UA SHOULD regularly check if the <a>application manifest</a> of
        installed applications has not been updated. To know if the file has
        been updated, HTTP semantics apply.
      </p>
      <p>
        For <a>package applications</a>, both <a>application manifest</a>s
        (outside and inside the package) SHOULD be updated. However, the
        <a>application manifest</a> inside the package SHOULD always be checked
        to make sure the update (or the install) is genuine.
      </p>
    </section>
    <section>
      <h2>
        Data isolation
      </h2>
      <p>
        In the context of a running application, all usual rules for data
        isolation MUST apply: same-origin policy, same-domain policy, or
        whatever is used. However, between two applications, those rules no
        longer apply. Two applications MUST be fully isolated from each other
        in the sense that they SHOULD NOT be able to access data from each
        other. For example, if App1 accesses <i>http://example.org</i> and gets
        a cookie from it, App2 should not be able to see that cookie when
        accessing <i>http://example.org</i> even if the usual cookie sharing
        policy should allow this to happen.
      </p>
      <p>
        This isolation SHOULD apply for all data storage like <i>cookies</i>,
        <i>localStorage</i>, <i>IndexedDB</i>, <i>app cache</i> and any other
        Web Platform mechanism that allows to store data and does not
        explicitly opt out from the application data isolation.<br>
        The isolation SHOULD also apply to UA specifics data storage. For
        example, any permission granted or denied to a host/origin/domain
        should be isolated per-application or auto-fill and auto-completion
        features for forms.
      </p>
    </section>
    <section>
      <h2>
        Navigation
      </h2>
      <p>
        Depending on the user interface around the application context,
        navigating outside the <a>application's origin</a> might lock the user
        out of the application. To prevent that, the UA SHOULD NOT allow
        navigation out of the <a>application's origin</a>, unless the origin is
        specified in the following <a>application manifest</a> property:
      </p>
      <ul>
        <li>
          <dfn id='prop-allow-navigation'>allow-navigation</dfn>: the property
          SHOULD contain an array of origins that can be navigated to from the
          application.
        </li>
      </ul>
      <p>
        If the application tries to navigate to an unauthorized origin, the UA
        SHOULD open the link in a regular but distinct browsing context.
      </p>
    </section>
    <section>
      <h2>
        System Messages
      </h2>
      <div class="todo">
        TODO: We might want to have something describing how an application
        goes inactive, get killed and everything to have a better description
        of system messages. TODO: there is no notion of multi-page applications
        in this description of system messages. We do not handle system
        messages that are registered on another page.
      </div>
      <p>
        <i>System Messages</i> are events sent by the system to an application
        which has registered for it before. Those events are different from DOM
        events in the sense that they are always originated by the system and
        that if the targeted application is not currently running, it will be
        started.<br>
        In addition, unhandled messages will stay in a queue.
      </p>
      <section class="informative">
        <h2>
          Use cases
        </h2>
        <p>
          Some applications might be interested in getting some events even if
          they are not running and want to be woken up if such event is sent
          while they are asleep.<br>
          In addition, when the application is being woken, it needs to know as
          soon as possible why it has been disturbed to be able to show the
          appropriate interface.<br>
          Finally, the capability of being woken should be transparent to the
          application.
        </p>
      </section>
      <section>
        <h2>
          Extension to the <a>Navigator</a> interface
        </h2>
        <section>
          <dl id='idl-def-systemMessageCallback' class='idl' title=
          'callback systemMessageCallback = void'>
            <dt>
              optional Object message
            </dt>
            <dd>
              The parameter <i>message</i> SHOULD contain an object that would
              be used by the handler and giving information about the system
              message. For example, a system message about a delivered pizza
              should give information about the pizzas that have been
              delivered. If the system message is already self-explanatory,
              <i>message</i> SHOULD be null.
            </dd>
          </dl>
          <dl title='partial interface Navigator' class='idl'>
            <dt>
              void setMessageHandler(DOMString type, systemMessageCallback?
              callback)
            </dt>
            <dd>
              The method MUST set <i>callback</i> as the new message handler
              for the <a>type of system message</a> <i>type</i>.<br>
              If <i>callback</i> is null, the current callback, if any, for the
              <a>type of message</a> <i>type</i> must be reset and no callback
              should no longer be set for this type.<br>
              If <i>callback</i> is not null and there was no message handler
              for the given type and there are messages in the <a>pool of
              messages</a> for the type, then the UA MUST start an asynchronous
              task that executes all the messages in the pool by the new
              handler in a <abbr title='First In First Out'>FIFO</abbr> basis
              and then remove all those messages from the <a>pool of
              messages</a>.<br>
              If the <i>callback</i> is not null and there is a message handler
              for the given type, that message handler should be replaced by
              <i>callback</i>.
            </dd>
            <dt>
              boolean hasPendingMessages(DOMString type)
            </dt>
            <dd>
              The method MUST returns true if there is at least one message in
              the <a>pool of messages</a> for the given <i>type</i>. Otherwise,
              it MUST return false.
            </dd>
          </dl>
        </section>
      </section>
      <section>
        <h2>
          Definitions
        </h2>
        <p>
          The <dfn>type of system message</dfn> identifies a category of system
          messages.<br>
          Application are able to register and handle system messages based on
          their types. There is no exhaustive list of system messages type. Any
          specification can create a new type of system message.
        </p>
        <p>
          Each application has a <dfn>pool of messages</dfn> for each <a>type
          of system message</a>. Every time a system message is sent to an
          application, if there is no handler for that message's type, the UA
          MUST add the message to the pool of messages used for that type.<br>
          The UA MAY, for memory optimization, discard old messages if the pool
          becomes too big or if the messages are too old.
        </p>
        <p>
          When a UA is required to <dfn>fire a system message</dfn> of a given
          type, it has to do one of these actions:
        </p>
        <ul>
          <li>If the application is running and a handler is defined, the UA
          MUST run the handling method;
          </li>
          <li>Otherwise, if the application is running and no handler is
          defined, the UA MUST add the message to the <a>pool of messages</a>;
          </li>
          <li>Otherwise, if the application is not running, the UA MUST add the
          message to the <a>pool of messages</a> and start the application.
          </li>
        </ul>
      </section>
    </section>
    <section>
      <h2>
        Permissions
      </h2>
      <section class="informative">
        <h2>
          Use cases
        </h2>
        <p>
          Some API might allow the application to access sensitive parts of the
          hardware or sensitive information. To prevent applications to access
          them, some APIs might require one or more permissions. For example,
          for an application to be allowed to access your geolocation
          information, it has to be granted the <i>geolocation</i> permission.
        </p>
      </section>
      <section>
        <h2>
          Permission declaration
        </h2>
        <p>
          An application SHOULD define all permissions it is going to use in
          the <a>application manifest</a>. The UA MAY automatically grant some
          permissions at install-time or ask the user to grant some
          applications. However, MAY, in addition or alternatively, ask the
          user to grant permissions at run-time.
        </p>
        <p>
          The user MUST be able to revoke a granted permission or grant a
          denied permission at any time.
        </p>
      </section>
      <section>
        <h2>
          Basic Permissions
        </h2>
        <p>
          Specifications are expected to declare the permissions they will
          require for their feature to work. Altough, some basic permissions
          can't really go into a specific specification or a related to
          specifications that might be harder to change.
        </p>
        <p>
          Thus, this specification defines the following permissions:
        </p>
        <table>
          <tr>
            <th>
              Permission Name
            </th>
            <th>
              Permission Description
            </th>
            <th>
              Access Type
            </th>
          </tr>
          <tr>
            <td>
              <code>notification</code>
            </td>
            <td>
              Allow the application to use the Web Notifications API.
            </td>
            <td>
              N/A
            </td>
          </tr>
          <tr>
            <td>
              <code>geolocation</code>
            </td>
            <td>
              Allow the application to access the Geolocation API.
            </td>
            <td>
              N/A
            </td>
          </tr>
          <tr>
            <td>
              <code>storage</code>
            </td>
            <td>
              Allow localStorage and IndexedDB without size limitations.
            </td>
            <td>
              N/A
            </td>
          </tr>
          <tr>
            <td>
              <code>webapps-manage</code>
            </td>
            <td>
              Allow access to the <code>navigator.apps.management</code> API to
              manage installed webapps.
            </td>
            <td>
              N/A
            </td>
          </tr>
        </table>
      </section>
      <section>
        <h2>
          Privileged applications
        </h2>
        <section class="informative">
          <h2>
            Use cases
          </h2>
          <p>
            Some applications require access to APIs which, if abused, may
            cause significant damage to the end user's services, data or
            devices. For example, an API allowing the use of SMS could be
            misused by a malicious application to send unwanted premium-rate
            messages costing the user money.
          </p>
          <p>
            Because the impact of using a malicious application with these
            privileges is higher, additional security mechanisms and processes
            are necessary to minimize the additional risk they present. This
            might include, for example, mandatory review of applications or
            certification. A simple user-authorized permission system is
            considered insufficient: users could be tricked into granting a
            malicious application access to inappropriate APIs, services or
            data.
          </p>
          <p>
            As a complement to permissioning, this specification defines a
            <em>privileged</em> class of application. Applications which are
            not privileged will not be able to access potentially dangerous
            APIs.
          </p>
        </section>
        <section>
          <h2>
            Chain of trust
          </h2>
          <p>
            An application is said to be a <dfn>privileged application</dfn> if
            the origin installing the application is trusted by the UA and the
            origin installing the application considers the application to be
            trustworthy.
          </p>
          <p>
            A UA SHOULD have the public key of all installation origins it
            considers to be trusted.
          </p>
        </section>
        <section>
          <h2>
            Marking an application privileged
          </h2>
          <p>
            A <a>hosted application</a> MUST be recognized as marked privileged
            by the installation origin if the <a>application manifest</a> is
            signed by the installation origin's private key.
          </p>
          <p>
            A <a>packaged application</a> MUST be recognized as marked
            privileged by the installation origin if the package is signed by
            the installation origin's private key.
          </p>
          <p>
            In both cases, the application SHOULD be considered as privileged
            by the UA if the UA considers the installation origin as trusted,
            following the chain of trust mentioned above.
          </p>
        </section>
        <section class="informative">
          <h2>
            Security considerations
          </h2>
          <p>
            UA should keep in mind that a signed package is way more secure
            than a signed manifest. A correctly signed package can only be
            compromised if the private key has been compromised or the
            cryptographic algorithm. A UA should not trust an installation
            origin if it does not trust its ability to keep safe its private
            key.
          </p>
          <p>
            On the other hands, a signed manifest only proves that the
            application is genuinely trusted (if the private key was not
            compromised nor the cryptographic algorithm). Anything else can be
            compromised given that it lives in the Internet. There is no need
            to list all possible attacks.
          </p>
          <p>
            An important difference between a <a>packaged application</a> and a
            <a>hosted application</a> is the ability to review the code. Any
            permission granted to a <a>packaged application</a> will be granted
            to the code inside the package only. That means trusting such
            application is way easier after a code review, for example.
          </p>
          <p>
            However, code review for <a>packaged application</a>s could be
            avoided if the installation origin trusts enough an application
            developer. Such developer could get all its <a>packaged
            application</a>s trusted without too much risk for the users.<br>
            The same thing could be done for <a>hosted application</a> except
            that it would be recommended to make sure that the developer has
            strong server security or would not risk any security flaw on their
            servers.
          </p>
        </section>
        <section>
          <h2>
            CSP Policy
          </h2>
          <section class="note">
            The following sub-section assumes that a <a>privileged
            application</a> can only be a <a>packaged application</a>. This
            needs to be updated.
          </section>
          <p>
            The following CSP policy MUST apply to all <a>privileged
            application</a>s [[!CSP]]:<br>
          </p>
          <p>
            <code>default-src *; script-src 'self'; object-src 'none';
            style-src 'self'</code>
          </p>
          <p>
            This puts the following restrictions on web pages part of a
            <a>privileged application</a>:
          </p>
          <ul>
            <li>Scripts can only be loaded from the package;
            </li>
            <li>Scripts can not use data:-URIs;
            </li>
            <li>Inline scripts can not be used;
            </li>
            <li>eval() can not be used. Neither can eval-like functions like
            setTimeout or "new Function". setTimeout can still be used as long
            as the first argument is a Function object rather than a string;
            </li>
            <li>onXXX attributes can't be used in the markup of pages. However,
            using the associated <a>EventHandler</a> is doable. For example:
            myElement.onXXX = someFunction;
            </li>
            <li>&lt;object&gt;, &lt;embed&gt; and &lt;applet&gt; are fully
            disabled. In other words, plugins won't work at all. Including
            flash.
            </li>
            <li>CSS can only be loaded from the package. Inline CSS is however
            allowed.
            </li>
          </ul>
          <p>
            This does not restrict any of the following:
          </p>
          <ul>
            <li>&lt;iframe&gt;s can still point to any URL;
            </li>
            <li>Images can still be loaded from anywhere. Including when loaded
            using an &lt;img&gt; element, when using CSS background images or
            when using other types of CSS images;
            </li>
            <li>Media (audio and video) can still be loaded from anywhere;
            </li>
            <li>Network connections can still be opened anywhere using
            data-centric APIs like XMLHttpRequest or WebSocket.
            </li>
          </ul>
          <p>
            There is no way for <a>privileged application</a>s to relax this
            policy.
          </p>
        </section>
      </section>
    </section>
    <section>
      <h2>
        Application life-cycle
      </h2>
      <section>
        <h2>
          Application states
        </h2>
        <p>
          At any time, an application MUST be in one of the following states:
          <a>running</a>, <a>paused</a>, <a>terminated</a>.
        </p>
        <p>
          An application is <dfn>running</dfn> when it has been launched by the
          UA and has not been put in <a>paused</a>. A <a>running</a>
          application can transition to <a>paused</a> or <a>terminated</a>
          states.
        </p>
        <p>
          If a <a>running</a> application transitions to a <a>paused</a> state,
          the UA MUST <a>fire a simple event</a> named <code>pause</code> on
          the <a>Application</a> object before switching its state.
        </p>
        <p>
          If a <a>running</a> application transitions to a <a>terminated</a>
          state, the UA MUST <a>fire a simple event</a> named
          <code>terminate</code> on the <a>Application</a> object before
          shutting down the application.
        </p>
        <p>
          An application is <dfn>paused</dfn> when the UA stops the execution
          of an application without terminating it. A <a>paused</a> application
          SHOULD have all its scripts no longer running, such as rendering,
          parsing, processing media files and any action that requires CPU and
          memory or would distract the user. A <a>paused</a> application can
          transition to <a>running</a> or <a>terminated</a> states.
        </p>
        <p>
          If a <a>paused</a> application transitions to a <a>running</a> state,
          the UA MUST <a>fire a simple event</a> named <code>resume</code> on
          the <a>Application</a> object after changing its state.
        </p>
        <p>
          An application is <dfn>terminated</dfn> when the application has been
          stopped and is no longer loaded in the system. The state of a
          <a>terminated</a> application can only be changed to <a>running</a>
          if the application is launched again.
        </p>
        <p>
          If a <a>terminated</a> application transitions to a <a>running</a>
          state, the UA MUST <a>fire a simple event</a> named
          <code>launch</code> on the <a>Application</a> object after the main
          browsing context is created but before the <code>load</code> and
          <code>DOMContentLoaded</code> events are fired.
        </p>
      </section>
      <section class='issue'>
        <p>
          The specification currently assumes that one will save important when
          paused so there is no terminate event when transitioning from pause
          to terminate.
        </p>
      </section>
      <section class='issue'>
        <p>
          Do we have real use cases for <code>launch</code>?<br>
          Is firing before <code>load</code> a hard thing to do?
        </p>
      </section>
      <section>
        <h2>
          Consequences of visibility
        </h2>
        <p>
          While an application is running, it can be part or fully hidden. The
          visibility events described in [[!PAGE-VISIBILITY]] MUST be sent when
          the visibility status of the application changes.
        </p>
        <p>
          In addition, when the application becomes fully hidden, the UA MAY
          put the application in a <a>paused</a> state.
        </p>
      </section>
    </section>
    <section class="appendix">
      <h2>
        <a>DOMRequest</a> interface
      </h2>
      <section class="note">
        <p>
          The <a>DOMRequest</a> interface is temporarily hosted by this
          specification. The <i>Runtime and Security Model for Web
          Applications</i> specificaton does not plan to keep that guest for
          ever, this is why it is currently staying in an appendix.
        </p>
      </section>
      <section class="informative">
        <h2>
          Use cases
        </h2>
        <p>
          Some methods want to return a value or do an action but can't do it
          synchronously, most of the time for performance reasons. In that
          case, most of those methods will use a callback mechanism to inform
          the caller of the success or the failure of the action.<br>
          However, this callback mechanism makes the code barely readable and
          there is no common pattern used by all API in the Web Platform.<br>
          <a>DOMRequest</a> intend to be used instead of those callbacks to
          make those APIs more developer-friendly and help code readability.
        </p>
      </section>
      <section>
        <h2>
          Definition
        </h2>
        <p>
          The <a>DOMRequest</a> interface is intended to be used by
          asynchronous methods that want to return something after performing
          an action or simply want to inform the caller that the action is
          done. It returned request can also be used to inform that an error
          happened during the operation.
        </p>
        <p>
          A <a>DOMRequest</a> has three state. It is whether
          <code>pending</code>, <code>success</code> or <code>error</code>.<br>
          The initial state of a <a>DOMRequest</a> MUST be
          <code>pending</code>.
        </p>
        <p>
          If a <a>DOMRequest</a> receives a <a>success message</a> while in the
          <code>pending</code> state, its state MUST change to
          <code>success</code> and SHOULD NOT change afterward.
        </p>
        <p>
          If a <a>DOMRequest</a> receives an <a>error message</a> while in the
          <code>pending</code> state, its state MUST change to
          <code>error</code> and SHOULD NOT change afterward.
        </p>
        <p>
          If a <a>DOMRequest</a> receives a <a>success message</a> or an
          <a>error message</a> while not in the <code>pending</code> state, the
          message MUST be ignored.
        </p>
        <p>
          A <dfn>success message</dfn> SHOULD be sent to the <a>DOMRequest</a>
          when the operation is successfully terminated. The message MAY
          contain a value which MUST be used by the <code>result</code>
          attribute. If the message does not contain a value, <i>null</i> MUST
          be used instead.
        </p>
        <p>
          As soon as a <a>success message</a> is received,
          <code>readyState</code> MUST return <code>done</code>,
          <code>result</code> MUST return the received value or <i>null</i> as
          explained above and the object MUST NOT change its state and MUST,
          therefore, ignore all following <a>success message</a> and <a>error
          message</a>.<br>
          Finally, the UA MUST <a>fire a simple event</a> named
          <code>success</code> on the object
        </p>
        <p>
          An <dfn>error message</dfn> SHOULD be sent to the <a>DOMRequest</a>
          when the operation has failed. The message MAY contain a value which
          MUST be a <a>DOMError</a> object and MUST be used by the
          <code>error</code> attribute. If the message does not contain a
          value, the UA SHOULD find the most appropriate <a>DOMError</a> that
          represents the failure.
        </p>
        <p>
          As soon as an <a>error message</a> is received,
          <code>readyState</code> MUST return <code>done</code>,
          <code>error</code> MUST return the received value the most
          appropriate error value as explained above and the object MUST NOT
          change its state and MUST, therefore, ignore all following <a>success
          message</a> and <a>error message</a>.<br>
          Finally, the UA MUST <a>fire a simple event</a> named
          <code>error</code> on the object.
        </p>
        <section>
          <dl title='interface DOMRequest : EventTarget' class='idl'>
            <dt>
              readonly attribute DOMString readyState
            </dt>
            <dd>
              The attribute MUST return <code>pending</code> if the current
              state is <code>pending</code>. Otherwise, it MUST return
              <code>done</code>.
            </dd>
            <dt>
              readonly attribute any result
            </dt>
            <dd>
              The attribute MUST return <code>undefined</code> if the current
              state is not <code>success</code>. Otherwise, it MUST return the
              value provided by the <a>success message</a> or <code>null</code>
              if no value was sent with the message.
            </dd>
            <dt>
              readonly attribute DOMError? error
            </dt>
            <dd>
              The attribute MUST return <i>null</i> if the current state is not
              <code>error</code>. Otherwise, it MUST return the value provided
              by by the <a>error message</a>. If there was no provided value,
              it SHOULD return the most appropriate <a>DOMError</a> that
              represents the failure.
            </dd>
            <dt>
              [TreatNonCallableAsNull] attribute EventHandler onsuccess
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
            <dt>
              [TreatNonCallableAsNull] attribute EventHandler onerror
            </dt>
            <dd>
              <div class="todo">
                TBD
              </div>
            </dd>
          </dl>
        </section>
        <section>
          <h2>
            Events
          </h2>
          <p>
            The following are the <a>event handlers</a> (and their
            corresponding <a>event handler event types</a>) that MUST be
            supported as attributes by the <code>DOMRequest</code> objects:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>
                  event handler
                </th>
                <th>
                  event handler event type
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <strong><code>onerror</code></strong>
                </td>
                <td>
                  <code>error</code>
                </td>
              </tr>
              <tr>
                <td>
                  <strong><code>onsuccess</code></strong>
                </td>
                <td>
                  <code>success</code>
                </td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
    <section class="appendix">
      <h2>
        Acknowledgments
      </h2>
      <p>
        Special thanks to the Mozilla team working on Open Web Apps, especially
        Anant Narayanan for his <i>Web Application Manifest Format and
        Management APIs</i> specification that this document reuse shamelessly
        and Fabrice Desré for his help in understanding why some decisions were
        made.
      </p>
      <p>
        Special thanks to the Samsung team, especially 金明(Ming Jin), Janusz
        Majnert and 송정기(Jungkee Song) for their work on the <i>System
        Application Runtime: Execution and Security Model</i> specification.
      </p>
      <p>
        Special thanks to Jonas Sicking and Marcos Caceres for their invaluable
        help.
      </p>
      <p>
        Thanks to John Lyle, Christophe Dumez and Jonathan Jeon for their
        useful comments and change proposals.
      </p>
    </section>
  </body>
</html>
